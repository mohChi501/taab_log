<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TAAB NFC Card Logger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>TAAB NFC Card Logger</h2>

  <!-- Card Scan Section -->
  <div class="bubble">
    <label>Scan Card (Mobile NFC or External Reader):
      <input type="text" id="manualCardInput" placeholder="Tap card or enter ID manually" oninput="handleManualCardInput()" autofocus>
    </label>
    <button type="button" onclick="scanCard()">📶 Scan via Mobile NFC</button>
    <p id="cardIdDisplay">Card ID: <em>None</em></p>
  </div>

  <!-- Entry Form -->
  <div class="bubble">
    <form id="cardForm">
      <label>Category:
        <select id="category" onchange="toggleExtraFields()">
          <option value="General">General</option>
          <option value="General Branded">General Branded</option>
          <option value="Student">Student</option>
          <option value="Student ID">Student ID</option>
          <option value="Golden">Golden</option>
        </select>
      </label>

      <label id="brandedInstitutionLabel" style="display:none;">Branded Institution:
        <input type="text" id="brandedInstitution">
      </label>

      <label id="studentIdLabel" style="display:none;">Student ID No.:
        <input type="text" id="studentIdNo">
      </label>

      <label id="homeroomLabel" style="display:none;">Homeroom:
        <input type="text" id="homeroom">
      </label>

      <label id="studentImageLabel" style="display:none;">Attach or Capture Image (optional):
        <input type="file" id="studentImage" accept="image/*" capture="environment">
      </label>

      <label>Name:
        <input type="text" id="name">
      </label>

      <label>Phone:
        <input type="text" id="phone">
      </label>

      <label>Address:
        <input type="text" id="address">
      </label>

      <button type="button" onclick="saveEntry()">💾 Save Entry</button>
    </form>
  </div>

  <!-- File Upload -->
  <div class="bubble">
    <h3>📂 Upload Existing File</h3>
    <input type="file" id="csvUpload"
      accept=".csv,text/csv,application/json,.json,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.xlsx"
      onchange="loadFile(event)">
    <p id="uploadStatus"></p>
  </div>

  <!-- Export & Clear -->
  <div class="bubble">
    <label>
      <input type="checkbox" id="includeImagesExport">
      Include images in export
    </label>
    <button type="button" onclick="exportCSV()">📤 Export CSV</button>
    <button type="button" onclick="exportJSON()">📤 Export JSON</button>
    <button type="button" onclick="clearSavedData()">🧹 Clear Auto-Saved Entries</button>
    <p id="status"></p>
  </div>

  <!-- Search -->
  <div class="bubble">
    <label>🔍 Search:
      <input type="text" id="searchInput" placeholder="Filter by any field..." oninput="filterEntries()">
    </label>
  </div>

  <!-- Preview Table -->
  <div class="bubble">
    <h3>📋 Scanned Entries Preview</h3>
    <table id="previewTable">
      <thead>
        <tr>
          <th>Card ID</th>
          <th>Category</th>
          <th>Branded Institution</th>
          <th>Student ID No.</th>
          <th>Homeroom</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Address</th>
          <th>Timestamp</th>
          <th>Filename</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Floating Image Popup -->
  <div id="imagePopup" class="popup-hover">
    <span class="close-btn" onclick="hideImagePopup()">×</span>
    <img id="popupImage" src="">
  </div>

  <!-- Auto-save Toast -->
  <div id="autosaveToast">✅ Auto-saved</div>

  <script src="script.js"></script>
</body>
</html>
